<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30 Day Handover</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f5f5f5;
        }

        .stats-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .average-count {
            font-size: 1.1em;
            color: #333;
            font-weight: bold;
        }

        .average-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .day-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .date-header {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .line-count {
            font-size: 0.8em;
            color: #666;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: normal;
        }

        textarea {
            width: calc(100% - 20px);
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76,175,80,0.2);
        }

        .save-status {
            color: #4CAF50;
            font-size: 0.8em;
            margin-top: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .save-status.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="stats-container">
        <div class="average-count" id="average-count">0 lines</div>
        <div class="average-label">Average lines per day</div>
    </div>
    <div id="days-container"></div>

    <script>
        function formatDate(date) {
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function countLines(text) {
            if (!text.trim()) return 0;
            return text.split(/\r\n|\r|\n/).length;
        }

        function updateAverageCount() {
            const textareas = document.querySelectorAll('textarea');
            let totalLines = 0;
            let nonEmptyCount = 0;
            
            textareas.forEach(textarea => {
                const lines = countLines(textarea.value);
                if (lines > 0) {
                    totalLines += lines;
                    nonEmptyCount++;
                }
            });
            
            const average = nonEmptyCount > 0 ? totalLines / nonEmptyCount : 0;
            document.getElementById('average-count').textContent = 
                `${average.toFixed(1)} lines (${nonEmptyCount} days with content)`;
        }

        function createDayElement(date) {
            const container = document.createElement('div');
            container.className = 'day-container';
            
            const dateHeader = document.createElement('div');
            dateHeader.className = 'date-header';
            
            const dateText = document.createElement('span');
            dateText.textContent = formatDate(date);
            
            const lineCount = document.createElement('span');
            lineCount.className = 'line-count';
            lineCount.textContent = '0 lines';
            
            dateHeader.appendChild(dateText);
            dateHeader.appendChild(lineCount);
            
            const textarea = document.createElement('textarea');
            textarea.placeholder = 'Enter your notes for this day...';
            
            const saveStatus = document.createElement('div');
            saveStatus.className = 'save-status';
            saveStatus.textContent = 'Changes saved';

            const dateKey = date.toISOString().split('T')[0];
            const savedContent = localStorage.getItem(dateKey);
            if (savedContent) {
                textarea.value = savedContent;
                lineCount.textContent = `${countLines(savedContent)} lines`;
            }

            let saveTimeout;
            textarea.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                lineCount.textContent = `${countLines(textarea.value)} lines`;
                updateAverageCount();
                saveTimeout = setTimeout(() => {
                    localStorage.setItem(dateKey, textarea.value);
                    saveStatus.classList.add('visible');
                    setTimeout(() => {
                        saveStatus.classList.remove('visible');
                    }, 2000);
                }, 500);
            });

            container.appendChild(dateHeader);
            container.appendChild(textarea);
            container.appendChild(saveStatus);
            return container;
        }

        function initializeDays() {
            const container = document.getElementById('days-container');
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dayElement = createDayElement(date);
                container.appendChild(dayElement);
            }
            updateAverageCount();
        }

        initializeDays();
    </script>
</body>
</html>
