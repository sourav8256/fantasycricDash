<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penalty Time Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .calculator {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            text-align: center;
        }

        .history {
            margin-top: 20px;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
        }

        .total {
            margin-top: 20px;
            font-weight: bold;
            text-align: right;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .pagination button {
            width: auto;
            padding: 5px 10px;
        }

        .page-info {
            text-align: center;
            margin: 10px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Penalty Time Calculator</h1>
        
        <div class="input-group">
            <label for="amount">Amount Spent (₹):</label>
            <input type="number" id="amount" min="0" step="1" placeholder="Enter amount">
        </div>

        <div class="input-group">
            <label for="rate">Penalty Rate (minutes per ₹):</label>
            <input type="number" id="rate" min="0" step="0.1" value="5" placeholder="Enter rate" onchange="saveRate()">
        </div>

        <button onclick="calculatePenalty()">Calculate Penalty</button>

        <div class="result" id="result">
            Your penalty time will appear here
        </div>

        <div id="countdown" class="result" style="display: none;">
            Time Remaining: <span id="countdown-display"></span>
        </div>

        <div class="history" id="history">
            <h2>History</h2>
            <!-- History items will be added here -->
        </div>

        <div class="total" id="total">
            Total Remaining Time: 0 minutes
        </div>
    </div>

    <script>
        let penalties = JSON.parse(localStorage.getItem('penalties') || '[]');
        let countdownInterval;
        const ITEMS_PER_PAGE = 10;
        let currentPage = 1;

        // Update display on page load
        window.addEventListener('load', () => {
            // Restore saved rate
            const savedRate = localStorage.getItem('penaltyRate');
            if (savedRate) {
                document.getElementById('rate').value = savedRate;
            }
            
            updateHistory();
            updateTotal();
            startCountdown();
        });

        function saveRate() {
            const rate = document.getElementById('rate').value;
            localStorage.setItem('penaltyRate', rate);
        }

        function calculatePenalty() {
            const amount = parseFloat(document.getElementById('amount').value);
            const rate = parseFloat(document.getElementById('rate').value);

            if (isNaN(amount) || isNaN(rate)) {
                alert('Please enter valid numbers');
                return;
            }

            const penaltyMinutes = amount * rate;
            const hours = Math.floor(penaltyMinutes / 60);
            const minutes = Math.round(penaltyMinutes % 60);

            const resultText = `Penalty: ${hours} hours and ${minutes} minutes`;
            document.getElementById('result').textContent = resultText;

            // Add to history
            penalties.push({
                amount: amount,
                minutes: penaltyMinutes,
                timestamp: new Date().toISOString(),
                endTime: new Date(Date.now() + penaltyMinutes * 60 * 1000).toISOString()
            });

            // Save to localStorage
            localStorage.setItem('penalties', JSON.stringify(penalties));

            currentPage = 1;
            updateHistory();
            updateTotal();
            startCountdown();

            // Clear input
            document.getElementById('amount').value = '';
        }

        function startCountdown() {
            clearInterval(countdownInterval);
            
            const countdownElement = document.getElementById('countdown');
            const countdownDisplay = document.getElementById('countdown-display');
            
            // Calculate total remaining time from all penalties
            function updateCountdown() {
                let totalRemainingSeconds = 0;
                const now = new Date();

                penalties.forEach(penalty => {
                    const endTime = new Date(penalty.endTime);
                    if (endTime > now) {
                        const remainingMs = endTime - now;
                        totalRemainingSeconds += remainingMs / 1000;
                    }
                });

                if (totalRemainingSeconds <= 0) {
                    countdownElement.style.display = 'none';
                    return;
                }

                countdownElement.style.display = 'block';
                const hours = Math.floor(totalRemainingSeconds / 3600);
                const minutes = Math.floor((totalRemainingSeconds % 3600) / 60);
                const seconds = Math.floor(totalRemainingSeconds % 60);

                countdownDisplay.textContent = 
                    `${hours}h ${minutes}m ${seconds}s`;
            }

            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function updateHistory() {
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = '<h2>History</h2>';

            // Add clear history button
            const clearButton = document.createElement('button');
            clearButton.textContent = 'Clear History';
            clearButton.style.marginBottom = '10px';
            clearButton.onclick = clearHistory;
            historyDiv.appendChild(clearButton);

            // Calculate pagination
            const totalPages = Math.ceil(penalties.length / ITEMS_PER_PAGE);
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;

            // Add page info
            const pageInfo = document.createElement('div');
            pageInfo.className = 'page-info';
            pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
            historyDiv.appendChild(pageInfo);

            // Show only items for current page
            penalties.slice().reverse()
                .slice(startIndex, endIndex)
                .forEach((penalty) => {
                    const hours = Math.floor(penalty.minutes / 60);
                    const minutes = Math.round(penalty.minutes % 60);
                    const endTime = new Date(penalty.endTime);
                    const isComplete = endTime <= new Date();
                    
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.style.opacity = isComplete ? '0.5' : '1';
                    historyItem.innerHTML = `
                        <span>₹${penalty.amount.toFixed(2)}</span>
                        <span>${hours}h ${minutes}m ${isComplete ? '(Completed)' : ''}</span>
                    `;
                    historyDiv.appendChild(historyItem);
                });

            // Add pagination controls if needed
            if (totalPages > 1) {
                const pagination = document.createElement('div');
                pagination.className = 'pagination';

                // Previous button
                const prevButton = document.createElement('button');
                prevButton.textContent = '← Previous';
                prevButton.disabled = currentPage === 1;
                prevButton.onclick = () => {
                    if (currentPage > 1) {
                        currentPage--;
                        updateHistory();
                    }
                };
                pagination.appendChild(prevButton);

                // Next button
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next →';
                nextButton.disabled = currentPage === totalPages;
                nextButton.onclick = () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        updateHistory();
                    }
                };
                pagination.appendChild(nextButton);

                historyDiv.appendChild(pagination);
            }
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear the history display? (Active penalties will continue)')) {
                // Only clear completed penalties
                const now = new Date();
                penalties = penalties.filter(penalty => {
                    const endTime = new Date(penalty.endTime);
                    return endTime > now; // Keep only active penalties
                });
                
                localStorage.setItem('penalties', JSON.stringify(penalties));
                currentPage = 1;
                updateHistory();
                updateTotal();
                document.getElementById('result').textContent = 'Your penalty time will appear here';
            }
        }

        function updateTotal() {
            const now = new Date();
            const totalMinutes = penalties.reduce((sum, penalty) => {
                const endTime = new Date(penalty.endTime);
                if (endTime > now) {
                    const remainingMs = endTime - now;
                    return sum + (remainingMs / (60 * 1000));
                }
                return sum;
            }, 0);

            const totalHours = Math.floor(totalMinutes / 60);
            const totalMinutesRemainder = Math.round(totalMinutes % 60);

            document.getElementById('total').textContent = 
                `Total Remaining Time: ${totalHours} hours and ${totalMinutesRemainder} minutes`;
        }

        // Update total every minute
        setInterval(updateTotal, 60000);
    </script>
</body>
</html>
